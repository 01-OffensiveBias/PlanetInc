@{
    Page.Title = "Title goes here";
    Layout = "_Layout.cshtml";


    var db = Database.Open("IISServer");
    var queryString = "SELECT r.Id, r.Terrain, r.Price, r.PlanetId, p.Name FROM Regions AS r JOIN Planets AS p ON r.PlanetId = p.Id";
    var regions = db.Query(queryString);

    var lastPlanetId = 0;
}
<br/>
<div class="col-lg-6">

    @if (!Request.Form.ToString().IsEmpty())
    {
        var r = new Reservation(1,
            Convert.ToInt32(Request.Form["regionId"]),
            Convert.ToDateTime(Request.Form["startDate"]),
            Convert.ToDateTime(Request.Form["endDate"])
            );

        if (!r.message.IsEmpty())
        {
            <div class="alert alert-dismissible @(r.error ? "alert-danger" : "alert-success")">
                <button type="button" class="close" data-dismiss="alert">×</button>
                @r.message
            </div>
        }
    }

    <div class="well bs-component">
        <form method="POST" action="Reserve.cshtml" name="register" class="form-horizontal">
            <fieldset>
                <legend>Make a Reservation</legend>
                <input type="hidden" name="clientId" value="1"/>
                <div class="form-group">
                    <label for="inputPassword" class="col-lg-2 control-label">Region: </label>
                    <div class="col-lg-10">
                        <select class="form-control" name="regionId">
                            @foreach (var row in regions)
                            {
                                if (row.PlanetId != lastPlanetId)
                                {
                                    lastPlanetId = row.PlanetId;
                                    <optgroup label="@row.Name"></optgroup>
                                }
                                <option value="@row.Id">Region @row.Id --- $@row.Price.ToString("#.00")</option>
                            }
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="" class="col-lg-2 control-label">Start Date</label>
                    <div class="col-lg-10">
                        <input class="form-control" type="date" name="startDate" required=""/>
                    </div>
                </div>

                <div class="form-group">
                    <label for="" class="col-lg-2 control-label">End Date</label>
                    <div class="col-lg-10">
                        <input class="form-control" type="date" name="endDate" required=""/>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-2">
                        <input class="form-control btn-primary" type="submit"/>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>